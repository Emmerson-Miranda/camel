Camel CDI - Kubernetes Examples
================================

In this examples I will demonstrate how to create jobs on-demand (via HTTP request) to process some task in isolation and detect when  the process finish to perform clean-up tasks.

To achieve this I am going to use Camel CDI to configure [Kubernetes components](https://camel.apache.org/components/latest/kubernetes-summary.html "Kubernetes components") such as Jobs and Pods.

## Configuration

You have to introduce master server's IP/port and OAuth token in order to connect with kubernetes in the application.properties file.

Find out more https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/

## Examples list

The implementation of this POC -don't pretend to establish best practices- show how to:

* List pods (KubernetesListJob class)
* List jobs (KubernetesListJob class)
* Create a job (KubernetesCreateJob class)
* Remove a job when its POD finish based on POD events (KubernetesRouteConsumerPods class)

** REST RESOURCES **

Create a random job 

```
$ curl http://localhost:8080/k8s/job -X POST
```

List jobs in JSON format

```
$ curl http://localhost:8080/k8s/job
```

List pods in JSON format

```
$ curl http://localhost:8080/k8s/job
```

** Create job **

Below image show the annotations, labels and pod definition generated by the source code.

![Kubectl command line](./img/kubectl.png "Command line") 



## Maven

You will need to compile this example first:
  mvn install

To run the example type
  mvn camel:run


